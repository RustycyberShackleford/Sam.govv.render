
<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>SAM.gov Results</title>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 24px; }
    .muted { color: #555; }
    .wrap { max-width: 820px; }
    .box { border:1px solid #ccc; border-radius:8px; padding:16px; background:#fafafa; }
    .card { border:1px solid #ddd; padding:12px; border-radius:8px; margin: 10px 0; background:white; }
    .empty { padding: 32px; text-align:center; color:#777; border:1px dashed #aaa; border-radius:8px; background:white; }
    .toolbar { margin: 12px 0 24px 0; }
    button { padding:10px 14px; font-size: 15px; }
  </style>
</head>
<body>
  <div class="wrap">
    <h2>SAM.gov Search Results</h2>
    <div class="muted">Query: <b>{{ query }}</b> {% if demo %}(demo mode){% endif %}</div>
    <div class="toolbar">
      <button id="capture">Capture & Save Screenshot</button>
      <span id="status" class="muted"></span>
    </div>
    <div id="captureArea" class="box">
      {% if not results %}
        <div class="empty">No matches found</div>
      {% else %}
        {% for r in results %}
          <div class="card">
            <div><b>{{ r.name }}</b></div>
            <div>UEI: {{ r.uei or '—' }} | CAGE: {{ r.cage or '—' }}</div>
            <div>Status: {{ r.status or '—' }}</div>
            <div>Address: {{ r.address or '—' }}</div>
          </div>
        {% endfor %}
      {% endif %}
    </div>
  </div>

  <script>
    const btn = document.getElementById('capture');
    const statusEl = document.getElementById('status');
    btn.addEventListener('click', async () => {
      statusEl.textContent = 'Capturing...';
      const area = document.getElementById('captureArea');
      const canvas = await html2canvas(area, {scale: 2});
      const dataUrl = canvas.toDataURL('image/png');
      const form = new FormData();
      form.append('imageData', dataUrl);
      form.append('name', "{{ query }}");
      const res = await fetch('/capture', { method: 'POST', body: form });
      const json = await res.json();
      if (!json.ok) { statusEl.textContent = 'Capture failed'; return; }
      statusEl.innerHTML = 'Saved. <a href="/download/' + json.filename + '">Download PNG</a> &nbsp;|&nbsp; <a href="/files" target="_blank">View /tmp files</a>';
    });
  </script>
</body>
</html>
